# ========================================
# CrossLogic Notification System Configuration
# ========================================

# General Settings
# ========================================
NOTIFICATIONS_ENABLED=true
NOTIFICATIONS_ASYNC_DELIVERY=true
NOTIFICATIONS_DELIVERY_TIMEOUT=30s
NOTIFICATIONS_MAX_CONCURRENT=10

# Discord Configuration
# ========================================
# Get webhook URL from: Discord Server Settings > Integrations > Webhooks
NOTIFICATIONS_DISCORD_ENABLED=true
NOTIFICATIONS_DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN

# Slack Configuration
# ========================================
# Get webhook URL from: https://api.slack.com/messaging/webhooks
NOTIFICATIONS_SLACK_ENABLED=true
NOTIFICATIONS_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
NOTIFICATIONS_SLACK_CHANNEL=#notifications

# Email Configuration (Resend)
# ========================================
# Get API key from: https://resend.com/api-keys
NOTIFICATIONS_EMAIL_ENABLED=true
NOTIFICATIONS_EMAIL_PROVIDER=resend
NOTIFICATIONS_EMAIL_FROM=noreply@crosslogic.ai
NOTIFICATIONS_EMAIL_TO=["ops@crosslogic.ai","billing@crosslogic.ai"]
NOTIFICATIONS_RESEND_API_KEY=re_YOUR_RESEND_API_KEY

# Generic Webhook Configuration
# ========================================
# For custom integrations (e.g., Zapier, Make, n8n)
NOTIFICATIONS_WEBHOOK_ENABLED=false
NOTIFICATIONS_WEBHOOK_URL=https://your-webhook-endpoint.com/webhook
NOTIFICATIONS_WEBHOOK_SECRET=your-webhook-signing-secret
NOTIFICATIONS_WEBHOOK_METHOD=POST
NOTIFICATIONS_WEBHOOK_HEADERS='{"X-Custom-Header":"value"}'

# Retry Configuration
# ========================================
# Maximum number of retry attempts for failed notifications
NOTIFICATIONS_MAX_RETRIES=3

# Base backoff duration (exponential backoff: base * 2^retry_count)
NOTIFICATIONS_RETRY_BACKOFF_BASE=5s

# Size of retry queue (number of tasks that can be queued)
NOTIFICATIONS_RETRY_QUEUE_SIZE=1000

# Number of concurrent retry workers
NOTIFICATIONS_RETRY_WORKERS=5

# Event Routing
# ========================================
# Route specific events to specific channels (JSON format)
# If not specified, all events go to all enabled channels
#
# Example: Send payments to Discord & Slack, but tenant signups only to email
# NOTIFICATIONS_EVENT_ROUTING='{
#   "payment.succeeded": ["discord", "slack"],
#   "tenant.created": ["email"],
#   "node.launched": ["discord", "slack"],
#   "node.terminated": ["discord", "slack", "email"]
# }'

# Uncomment to use custom routing:
# NOTIFICATIONS_EVENT_ROUTING='{"payment.succeeded":["discord","slack","email"],"tenant.created":["email"]}'

# ========================================
# Quick Start Guide
# ========================================
#
# 1. Discord Setup:
#    - Go to your Discord server
#    - Server Settings > Integrations > Webhooks
#    - Create New Webhook
#    - Copy Webhook URL
#    - Paste into NOTIFICATIONS_DISCORD_WEBHOOK_URL
#
# 2. Slack Setup:
#    - Visit https://api.slack.com/messaging/webhooks
#    - Create a new app or use existing
#    - Enable Incoming Webhooks
#    - Add New Webhook to Workspace
#    - Copy Webhook URL
#    - Paste into NOTIFICATIONS_SLACK_WEBHOOK_URL
#
# 3. Resend Setup (Email):
#    - Sign up at https://resend.com
#    - Verify your domain
#    - Generate API Key
#    - Paste into NOTIFICATIONS_RESEND_API_KEY
#    - Update NOTIFICATIONS_EMAIL_FROM with your verified domain
#
# 4. Test Your Configuration:
#    - Start the control plane server
#    - Create a test tenant via API
#    - Check Discord/Slack/Email for notification
#
# ========================================
# Event Types
# ========================================
#
# The following events trigger notifications:
# - tenant.created         (New organization signup)
# - payment.succeeded      (Successful payment)
# - payment.failed         (Failed payment)
# - node.launched          (GPU node launched)
# - node.terminated        (Spot instance termination warning)
# - node.health_degraded   (Node health below threshold)
# - cost.anomaly_detected  (Unusual spending detected)
# - ratelimit.threshold_reached (API rate limit warning)
#
# ========================================
# Troubleshooting
# ========================================
#
# No notifications received?
# 1. Check NOTIFICATIONS_ENABLED=true
# 2. Verify channel-specific ENABLED flags
# 3. Check webhook URLs are correct
# 4. Review application logs for errors
# 5. Test webhooks manually using curl
#
# Duplicate notifications?
# - Redis idempotency cache is working correctly
# - Events are deduplicated by event ID
# - Check logs for "duplicate event" messages
#
# Slow notification delivery?
# - Increase NOTIFICATIONS_RETRY_WORKERS
# - Increase NOTIFICATIONS_MAX_CONCURRENT
# - Check network latency to webhook endpoints
#
# ========================================
