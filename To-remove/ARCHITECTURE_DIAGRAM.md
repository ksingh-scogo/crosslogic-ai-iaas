# ğŸ—ï¸ System Architecture - Visual Overview

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                                â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Dashboard (Next.js) - http://localhost:3000                   â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  [Models]  [Launch]  [Nodes]  [API Keys]  [Usage]              â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Launch Instance UI                                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Select Model (from R2)                                â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Choose Provider (Azure/AWS/GCP)                       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Pick Region & Instance Type                           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ [Launch] button                                       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Real-time progress visualization                      â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP Requests
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CONTROL PLANE (Go)                              â”‚
â”‚                   http://localhost:8080                               â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   API Gateway    â”‚  â”‚   Orchestrator   â”‚  â”‚    Scheduler     â”‚   â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ Auth           â”‚  â”‚ â€¢ Launch nodes   â”‚  â”‚ â€¢ Route requests â”‚   â”‚
â”‚  â”‚ â€¢ Rate limiting  â”‚  â”‚ â€¢ Monitor health â”‚  â”‚ â€¢ Load balance   â”‚   â”‚
â”‚  â”‚ â€¢ Routing        â”‚  â”‚ â€¢ Auto-recovery  â”‚  â”‚ â€¢ Health checks  â”‚   â”‚
â”‚  â”‚ â€¢ Billing        â”‚  â”‚ â€¢ Sky integrationâ”‚  â”‚ â€¢ Failover       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                      â”‚                      â”‚             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
                    â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STORAGE LAYER                                  â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   PostgreSQL     â”‚  â”‚      Redis       â”‚  â”‚  Cloudflare R2   â”‚   â”‚
â”‚  â”‚   :5432          â”‚  â”‚      :6379       â”‚  â”‚  (Models)        â”‚   â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ Metadata       â”‚  â”‚ â€¢ Rate limits    â”‚  â”‚ â€¢ LLM models     â”‚   â”‚
â”‚  â”‚ â€¢ Tenants        â”‚  â”‚ â€¢ Session cache  â”‚  â”‚ â€¢ Zero egress    â”‚   â”‚
â”‚  â”‚ â€¢ Usage tracking â”‚  â”‚ â€¢ Job queue      â”‚  â”‚ â€¢ CDN cached     â”‚   â”‚
â”‚  â”‚ â€¢ Billing        â”‚  â”‚ â€¢ Hot data       â”‚  â”‚ â€¢ S3-compatible  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ SkyPilot Launch
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GPU INSTANCES (Multi-Cloud)                      â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Azure Spot     â”‚  â”‚    AWS Spot      â”‚  â”‚    GCP Spot      â”‚   â”‚
â”‚  â”‚   Instance       â”‚  â”‚    Instance      â”‚  â”‚    Instance      â”‚   â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ vLLM Engine  â”‚ â”‚  â”‚ â”‚ vLLM Engine  â”‚ â”‚  â”‚ â”‚ vLLM Engine  â”‚ â”‚   â”‚
â”‚  â”‚ â”‚              â”‚ â”‚  â”‚ â”‚              â”‚ â”‚  â”‚ â”‚              â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ Streams from â”‚ â”‚  â”‚ â”‚ Streams from â”‚ â”‚  â”‚ â”‚ Streams from â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ R2 via S3    â”‚ â”‚  â”‚ â”‚ R2 via S3    â”‚ â”‚  â”‚ â”‚ R2 via S3    â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ Node Agent   â”‚ â”‚  â”‚ â”‚ Node Agent   â”‚ â”‚  â”‚ â”‚ Node Agent   â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ Heartbeat  â”‚ â”‚  â”‚ â”‚ â€¢ Heartbeat  â”‚ â”‚  â”‚ â”‚ â€¢ Heartbeat  â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ Metrics    â”‚ â”‚  â”‚ â”‚ â€¢ Metrics    â”‚ â”‚  â”‚ â”‚ â€¢ Metrics    â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request Flow - User Launch Instance

```
Step 1: User Action
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚  User clicks "Launch" button
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /admin/instances/launch
       â”‚ {
       â”‚   "model_name": "mistralai/Mistral-7B-Instruct-v0.3",
       â”‚   "provider": "azure",
       â”‚   "region": "eastus",
       â”‚   "instance_type": "Standard_NV36ads_A10_v5",
       â”‚   "use_spot": true
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard Container (Next.js)              â”‚
â”‚  â€¢ Validates input                          â”‚
â”‚  â€¢ Sends API request                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP Request
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Control Plane Container (Go)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Gateway: admin_models.go               â”‚ â”‚
â”‚  â”‚ â€¢ Authenticate (X-Admin-Token)         â”‚ â”‚
â”‚  â”‚ â€¢ Validate model exists                â”‚ â”‚
â”‚  â”‚ â€¢ Generate job ID                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                              â”‚
â”‚               â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Orchestrator: skypilot.go              â”‚ â”‚
â”‚  â”‚ â€¢ Generate SkyPilot YAML               â”‚ â”‚
â”‚  â”‚ â€¢ Set R2 credentials as env vars       â”‚ â”‚
â”‚  â”‚ â€¢ Set model path: s3://bucket/model    â”‚ â”‚
â”‚  â”‚ â€¢ Execute: sky launch --cloud azure    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ subprocess: sky launch
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SkyPilot (inside control-plane container)  â”‚
â”‚  â€¢ Requests spot instance from Azure        â”‚
â”‚  â€¢ Provisions VM: Standard_NV36ads_A10_v5   â”‚
â”‚  â€¢ Installs dependencies                    â”‚
â”‚  â€¢ Starts vLLM with env vars                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Cloud API calls
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Azure Cloud (Spot Instance)                â”‚
â”‚  â€¢ VM created in eastus region              â”‚
â”‚  â€¢ GPU: A10 (24GB VRAM)                     â”‚
â”‚  â€¢ Installing: CUDA, vLLM, dependencies     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Setup script runs
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GPU Instance - vLLM Starting               â”‚
â”‚  $ vllm serve                               â”‚
â”‚      s3://crosslogic-models/mistralai/...   â”‚
â”‚      --port 8000                            â”‚
â”‚      --tensor-parallel-size 1               â”‚
â”‚                                             â”‚
â”‚  vLLM streams model from R2:                â”‚
â”‚  â€¢ 30-60 second load time                   â”‚
â”‚  â€¢ Zero egress fees                         â”‚
â”‚  â€¢ CDN cached globally                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Model loaded âœ…
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Node Agent                                 â”‚
â”‚  â€¢ Registers with control plane             â”‚
â”‚  â€¢ POST /admin/nodes/register               â”‚
â”‚  â€¢ Sends health metrics every 30s           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Registration
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Control Plane                              â”‚
â”‚  â€¢ Node added to active pool                â”‚
â”‚  â€¢ Scheduler starts routing requests        â”‚
â”‚  â€¢ Ready to serve! ğŸ‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Status: "completed"
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard                                  â”‚
â”‚  â€¢ Polls: GET /admin/instances/status       â”‚
â”‚  â€¢ Updates progress bar                     â”‚
â”‚  â€¢ Shows: "Instance ready!"                 â”‚
â”‚  â€¢ Node appears in nodes list               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Time: 5-10 minutes
```

## Inference Request Flow

```
Step 1: Client Request
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚  curl or SDK
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /v1/chat/completions
       â”‚ Authorization: Bearer sk-xxx
       â”‚ {
       â”‚   "model": "mistral-7b",
       â”‚   "messages": [{"role": "user", "content": "Hello!"}]
       â”‚ }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Control Plane: API Gateway                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Authenticate API Key                â”‚ â”‚
â”‚  â”‚    â€¢ Verify sk-xxx exists              â”‚ â”‚
â”‚  â”‚    â€¢ Check tenant/environment          â”‚ â”‚
â”‚  â”‚    â€¢ Load rate limits                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2. Rate Limiting                       â”‚ â”‚
â”‚  â”‚    â€¢ Check: 100 req/min limit          â”‚ â”‚
â”‚  â”‚    â€¢ Check: 1M tokens/day              â”‚ â”‚
â”‚  â”‚    â€¢ Update Redis counters             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 3. Load Balancing                      â”‚ â”‚
â”‚  â”‚    â€¢ Query active nodes for mistral-7b â”‚ â”‚
â”‚  â”‚    â€¢ Check health, load, latency       â”‚ â”‚
â”‚  â”‚    â€¢ Select best node (round-robin)    â”‚ â”‚
â”‚  â”‚    â€¢ Target: azure-eastus-node-1       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Forward request
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GPU Instance: azure-eastus-node-1          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ vLLM Engine                            â”‚ â”‚
â”‚  â”‚ â€¢ Model: mistral-7b (already loaded)   â”‚ â”‚
â”‚  â”‚ â€¢ GPU: A10 (24GB VRAM)                 â”‚ â”‚
â”‚  â”‚ â€¢ Processes request                    â”‚ â”‚
â”‚  â”‚ â€¢ Generates response                   â”‚ â”‚
â”‚  â”‚ â€¢ Time: 500ms                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Response
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Control Plane: Gateway                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 4. Response Processing                 â”‚ â”‚
â”‚  â”‚    â€¢ Count tokens (input: 10, output: 50) â”‚ â”‚
â”‚  â”‚    â€¢ Record usage in PostgreSQL        â”‚ â”‚
â”‚  â”‚    â€¢ Update billing meter              â”‚ â”‚
â”‚  â”‚    â€¢ Calculate cost: $0.003            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Return response
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚  Receives completion
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Time: ~500ms
```

## Docker Container Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Host (Your MacBook)                                         â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  dashboard:3000    â”‚  â”‚  control-plane:8080â”‚                     â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚                     â”‚
â”‚  â”‚  Built from:       â”‚  â”‚  Built from:       â”‚                     â”‚
â”‚  â”‚  Dockerfile.       â”‚  â”‚  Dockerfile.       â”‚                     â”‚
â”‚  â”‚  dashboard         â”‚  â”‚  control-plane     â”‚                     â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚                     â”‚
â”‚  â”‚  â€¢ Next.js 15      â”‚  â”‚  â€¢ Go 1.22         â”‚                     â”‚
â”‚  â”‚  â€¢ Standalone      â”‚  â”‚  â€¢ SkyPilot        â”‚                     â”‚
â”‚  â”‚  â€¢ Prod build      â”‚  â”‚  â€¢ Orchestrator    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚           â”‚                       â”‚                                 â”‚
â”‚           â”‚   HTTP calls          â”‚                                 â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                       â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚                    â”‚                    â”‚                        â”‚
â”‚  â–¼                    â–¼                    â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ postgres:5432â”‚  â”‚  redis:6379  â”‚  â”‚ grafana:3001 â”‚              â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â”‚ â€¢ Metadata   â”‚  â”‚ â€¢ Cache      â”‚  â”‚ â€¢ Metrics    â”‚              â”‚
â”‚  â”‚ â€¢ Persistenceâ”‚  â”‚ â€¢ Rate limit â”‚  â”‚ â€¢ Optional   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                       â”‚
â”‚  Network: crosslogic-network                                         â”‚
â”‚  Volumes: postgres_data, redis_data, grafana_data                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow - Model Loading from R2

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: Model Upload (One-time)                                    â”‚
â”‚                                                                       â”‚
â”‚  python3 scripts/upload-model-to-r2.py mistralai/Mistral-7B-Instructâ”‚
â”‚                                                                       â”‚
â”‚  HuggingFace Hub  â”€â”€â”€â”€downloadâ”€â”€â”€â”€>  Local Disk  â”€â”€â”€â”€uploadâ”€â”€â”€â”€>    â”‚
â”‚  (Original)                          (Temp)                          â”‚
â”‚                                                                       â”‚
â”‚                                        â”‚                              â”‚
â”‚                                        â–¼                              â”‚
â”‚                              Cloudflare R2 Bucket                     â”‚
â”‚                              crosslogic-models/                       â”‚
â”‚                                â”œâ”€â”€ mistralai/                         â”‚
â”‚                                â”‚   â””â”€â”€ Mistral-7B-Instruct-v0.3/      â”‚
â”‚                                â”‚       â”œâ”€â”€ config.json                â”‚
â”‚                                â”‚       â”œâ”€â”€ tokenizer.json             â”‚
â”‚                                â”‚       â”œâ”€â”€ model-00001.safetensors    â”‚
â”‚                                â”‚       â””â”€â”€ model-00002.safetensors    â”‚
â”‚                                â””â”€â”€ meta-llama/                        â”‚
â”‚                                    â””â”€â”€ Meta-Llama-3-8B-Instruct/      â”‚
â”‚                                                                       â”‚
â”‚  Size: ~14GB per 7B model                                            â”‚
â”‚  Time: 20-30 minutes (depends on internet)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Global CDN Caching
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare Global CDN                                               â”‚
â”‚  â€¢ Caches model files at edge locations                             â”‚
â”‚  â€¢ Zero egress fees                                                  â”‚
â”‚  â€¢ Fast downloads from nearest POP                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ vLLM streams via S3 API
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: vLLM Loads Model (Each Launch)                             â”‚
â”‚                                                                       â”‚
â”‚  GPU Instance (Azure/AWS/GCP)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ vLLM Engine                                                  â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚ $ vllm serve s3://crosslogic-models/mistralai/Mistral-7B... â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚ Env vars:                                                    â”‚    â”‚
â”‚  â”‚ â€¢ R2_ENDPOINT=https://xxx.r2.cloudflarestorage.com          â”‚    â”‚
â”‚  â”‚ â€¢ AWS_ACCESS_KEY_ID=xxx                                     â”‚    â”‚
â”‚  â”‚ â€¢ AWS_SECRET_ACCESS_KEY=xxx                                 â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚ Process:                                                     â”‚    â”‚
â”‚  â”‚ 1. vLLM reads model files via S3 API                        â”‚    â”‚
â”‚  â”‚ 2. Streams directly from R2/CDN                             â”‚    â”‚
â”‚  â”‚ 3. No local disk storage needed                             â”‚    â”‚
â”‚  â”‚ 4. Loads model shards to GPU VRAM                           â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚ Time: 30-60 seconds (vs 5-10 min downloading)               â”‚    â”‚
â”‚  â”‚ Cost: $0 egress (vs $1-2 per launch)                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security & Auth Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Authentication & Authorization                                       â”‚
â”‚                                                                        â”‚
â”‚  User/Client  â”€â”€â”€â”€â”€[1]â”€â”€â”€â”€â”€>  API Gateway                             â”‚
â”‚  (sk-xxx123)                  (Control Plane)                         â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â–¼                                  â”‚
â”‚                               [2] Validate API Key                     â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â”œâ”€â”€> Redis (Cache check)           â”‚
â”‚                                     â”‚    â€¢ Hit: Return cached          â”‚
â”‚                                     â”‚    â€¢ Miss: Query DB              â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â”œâ”€â”€> PostgreSQL                    â”‚
â”‚                                     â”‚    â€¢ Lookup api_keys table       â”‚
â”‚                                     â”‚    â€¢ Get tenant_id, env_id       â”‚
â”‚                                     â”‚    â€¢ Get rate limits             â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â–¼                                  â”‚
â”‚                               [3] Check Permissions                    â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â”œâ”€â”€> Is key active?                â”‚
â”‚                                     â”œâ”€â”€> Is tenant active?             â”‚
â”‚                                     â”œâ”€â”€> Is environment active?        â”‚
â”‚                                     â”œâ”€â”€> Is model allowed?             â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â–¼                                  â”‚
â”‚                               [4] Rate Limiting                        â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â”œâ”€â”€> Global: 10K req/min           â”‚
â”‚                                     â”œâ”€â”€> Tenant: 1K req/min            â”‚
â”‚                                     â”œâ”€â”€> Environment: 100 req/min      â”‚
â”‚                                     â”œâ”€â”€> API Key: 10 req/min           â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â–¼                                  â”‚
â”‚                               [5] Forward Request                      â”‚
â”‚                                     â”‚                                  â”‚
â”‚                                     â””â”€â”€> GPU Instance                  â”‚
â”‚                                                                        â”‚
â”‚  Admin Operations:                                                    â”‚
â”‚                                                                        â”‚
â”‚  Admin UI  â”€â”€â”€â”€â”€[X-Admin-Token]â”€â”€â”€â”€â”€>  API Gateway                    â”‚
â”‚                                              â”‚                         â”‚
â”‚                                              â–¼                         â”‚
â”‚                                        Compare with:                   â”‚
â”‚                                        ADMIN_API_TOKEN env var         â”‚
â”‚                                              â”‚                         â”‚
â”‚                                              â”œâ”€> Match: Allow          â”‚
â”‚                                              â””â”€> Mismatch: Deny (403)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Improvements Visualized

### Before: Manual CLI Workflow

```
Developer Laptop
      â”‚
      â”œâ”€â”€ Install Go 1.22+
      â”œâ”€â”€ Install Node.js 18+
      â”œâ”€â”€ Install npm
      â”œâ”€â”€ Install SkyPilot
      â”œâ”€â”€ Configure clouds manually
      â”‚
      â”œâ”€â”€ Terminal 1: go run cmd/server/main.go
      â”œâ”€â”€ Terminal 2: npm run dev
      â”œâ”€â”€ Terminal 3: sky launch yaml-file
      â”‚
      â””â”€â”€ Check logs for status
```

### After: UI-Driven Docker Workflow

```
Developer Laptop (Only Docker!)
      â”‚
      â”œâ”€â”€ docker compose up -d
      â”‚
      â””â”€â”€ Browser: http://localhost:3000
            â”‚
            â”œâ”€â”€ Click "Launch" button
            â”œâ”€â”€ Watch progress bar
            â””â”€â”€ Done! âœ…
```

---

## Scaling Architecture

```
Production Deployment (Future)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Global Load Balancer (Cloudflare)                                  â”‚
â”‚  â€¢ DDoS protection                                                   â”‚
â”‚  â€¢ SSL termination                                                   â”‚
â”‚  â€¢ Geographic routing                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Region: US   â”‚  â”‚ Region: EU   â”‚  â”‚ Region: APAC â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ K8s Cluster  â”‚  â”‚ K8s Cluster  â”‚  â”‚ K8s Cluster  â”‚
â”‚ â€¢ Control    â”‚  â”‚ â€¢ Control    â”‚  â”‚ â€¢ Control    â”‚
â”‚   Plane (3x) â”‚  â”‚   Plane (3x) â”‚  â”‚   Plane (3x) â”‚
â”‚ â€¢ Dashboard  â”‚  â”‚ â€¢ Dashboard  â”‚  â”‚ â€¢ Dashboard  â”‚
â”‚   (2x)       â”‚  â”‚   (2x)       â”‚  â”‚   (2x)       â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ Managed PG   â”‚  â”‚ Managed PG   â”‚  â”‚ Managed PG   â”‚
â”‚ Managed Redisâ”‚  â”‚ Managed Redisâ”‚  â”‚ Managed Redisâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Global GPU Node Pool â”‚
              â”‚                      â”‚
              â”‚ â€¢ Azure spots        â”‚
              â”‚ â€¢ AWS spots          â”‚
              â”‚ â€¢ GCP spots          â”‚
              â”‚ â€¢ Auto-scaling       â”‚
              â”‚ â€¢ Multi-region       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Total Components**: 8 containers  
**Total Services**: 4 core + 1 optional  
**Setup Time**: 5-30 minutes  
**Operational Complexity**: Minimal  
**Production Readiness**: High  


